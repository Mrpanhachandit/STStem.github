<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>RC Car Controller v1.0</title>
    <link rel="icon" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><text y='.9em' font-size='90'>üöó</text></svg>">
    <style>
        /* Mobile-First Reset and Base Styles */
        :root {
            --primary-color: #007bff; /* Blue */
            --secondary-color: #6c757d; /* Gray */
            --background-color: #f8f9fa; /* Light background */
            --card-background: #ffffff; /* White card */
            --success-color: #28a745; /* Green */
            --danger-color: #dc3545; /* Red */
            --border-radius: 12px;
            --box-shadow: 0 4px 12px rgba(0, 0, 0, 0.08);
            --transition-speed: 0.3s;
        }

        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
            -webkit-tap-highlight-color: transparent;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial, sans-serif;
            background-color: var(--background-color);
            color: #343a40;
            min-height: 100vh;
            display: flex;
            flex-direction: column;
        }

        .container {
            flex-grow: 1;
            padding: 20px;
            max-width: 600px;
            width: 100%;
            margin: 0 auto;
            padding-bottom: 70px; /* Space for fixed nav */
        }

        /* --- Global Components --- */
        .card {
            background-color: var(--card-background);
            border-radius: var(--border-radius);
            box-shadow: var(--box-shadow);
            padding: 20px;
            margin-bottom: 20px;
            animation: fadeIn var(--transition-speed) ease-out;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        h1, h2, h3 {
            color: #212529;
            margin-bottom: 10px;
        }

        p {
            margin-bottom: 15px;
            line-height: 1.6;
        }

        /* --- Navigation Bar (Bottom) --- */
        .nav-bar {
            position: fixed;
            bottom: 0;
            left: 0;
            right: 0;
            height: 60px;
            background-color: var(--card-background);
            box-shadow: 0 -2px 10px rgba(0, 0, 0, 0.1);
            display: flex;
            justify-content: space-around;
            align-items: center;
            z-index: 1000;
        }

        .nav-item {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            flex: 1;
            padding: 5px 0;
            color: var(--secondary-color);
            text-decoration: none;
            font-size: 0.75em;
            transition: color var(--transition-speed);
        }

        .nav-item i {
            font-size: 24px;
            margin-bottom: 2px;
        }

        .nav-item.active {
            color: var(--primary-color);
        }

        /* --- Page Content Styling --- */
        .page {
            display: none;
        }

        .page.active {
            display: block;
        }

        /* --- Connect & Control Page --- */
        #connect-button {
            width: 100%;
            padding: 15px;
            font-size: 1.1em;
            font-weight: bold;
            color: white;
            background-color: var(--primary-color);
            border: none;
            border-radius: var(--border-radius);
            cursor: pointer;
            margin-bottom: 20px;
            transition: background-color var(--transition-speed), transform 0.1s;
        }

        #connect-button:hover:not(:disabled) {
            background-color: #0056b3;
        }

        #connect-button:active:not(:disabled) {
            transform: scale(0.98);
        }

        #connect-button:disabled {
            background-color: var(--secondary-color);
            cursor: not-allowed;
            opacity: 0.6;
        }

        #status-display {
            padding: 15px;
            border-radius: var(--border-radius);
            text-align: center;
            font-weight: bold;
            margin-bottom: 20px;
            background-color: #e9ecef;
            transition: background-color var(--transition-speed);
        }

        .status-connected {
            background-color: var(--success-color);
            color: white;
        }

        .status-not-connected {
            background-color: var(--danger-color);
            color: white;
        }

        .control-grid {
            display: grid;
            grid-template-areas:
                ". f ."
                "l s r"
                ". b .";
            gap: 15px;
            max-width: 400px;
            margin: 0 auto;
        }

        .control-grid-item {
            display: flex;
            justify-content: center;
            align-items: center;
        }

        #btn-forward { grid-area: f; }
        #btn-backward { grid-area: b; }
        #btn-left { grid-area: l; }
        #btn-right { grid-area: r; }
        #btn-stop { grid-area: s; }

        .control-btn {
            width: 80px;
            height: 80px;
            background-color: var(--primary-color);
            color: white;
            border: none;
            border-radius: 50%;
            font-size: 2.5em;
            display: flex;
            justify-content: center;
            align-items: center;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.2);
            transition: background-color var(--transition-speed), transform 0.1s;
            cursor: pointer;
            outline: none;
            user-select: none;
        }
        
        #btn-stop {
            background-color: var(--danger-color);
        }

        .control-btn:active {
            transform: scale(0.95);
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.3);
        }

        /* Make side buttons larger and non-circular for better hit area */
        #btn-left, #btn-right {
            width: 100px;
            height: 100px;
            border-radius: var(--border-radius);
            font-size: 2em;
        }

        /* --- Contact Page --- */
        .contact-link {
            display: block;
            text-decoration: none;
            padding: 15px;
            margin-bottom: 10px;
            border-radius: var(--border-radius);
            background-color: var(--primary-color);
            color: white;
            font-weight: bold;
            text-align: center;
            transition: background-color var(--transition-speed), transform 0.1s;
        }

        .contact-link:hover {
            background-color: #0056b3;
        }

        .contact-link i {
            margin-right: 10px;
        }

        /* Font Awesome Icons (using a simple, lightweight CSS-only alternative for common icons) */
        /* Since external resources are forbidden, we'll use emojis as icons */
        .icon { font-style: normal; display: inline-block; }
    </style>
</head>
<body>

    <div class="container">
        <div id="home" class="page active">
            <header style="text-align: center; margin-bottom: 30px;">
                <h1 style="color: var(--primary-color); font-size: 2.5em; margin-top: 10px;">RC Car Controller v1.0</h1>
                <p style="color: var(--secondary-color);">Mobile-ready interface for Bluetooth control.</p>
            </header>

            <div class="card">
                <h2>Features ‚ú®</h2>
                <p>This web application uses the **Web Bluetooth API** to connect to an HC-05 (or similar) module for controlling a custom-built RC vehicle.</p>
                <ul>
                    <li>**Wireless Control:** Send 'F', 'B', 'L', 'R', 'S' commands over Bluetooth.</li>
                    <li>**Mobile-First:** Optimized layout for smartphone use.</li>
                    <li>**Modern UI:** Clean, light, and responsive design.</li>
                </ul>
                <p style="margin-top: 20px; font-style: italic;">**Note:** Your browser (e.g., Chrome on Android) must support the Web Bluetooth API to work.</p>
            </div>
        </div>

        <div id="control" class="page">
            <h2 style="text-align: center; margin-bottom: 20px;">Connection & Control üïπÔ∏è</h2>
            
            <div id="status-display" class="status-not-connected">
                <span id="connection-text">Not Connected</span><br>
                <span id="device-name">No Device Selected</span>
            </div>

            <button id="connect-button">CONNECT BLUETOOTH</button>

            <div class="card">
                <h3>RC Controls</h3>
                <div class="control-grid">
                    <div class="control-grid-item" id="btn-forward">
                        <button class="control-btn" data-command="F" disabled>‚ñ≤</button>
                    </div>
                    <div class="control-grid-item" id="btn-left">
                        <button class="control-btn" data-command="L" disabled>‚óÄ</button>
                    </div>
                    <div class="control-grid-item" id="btn-stop">
                        <button class="control-btn" data-command="S" disabled>S</button>
                    </div>
                    <div class="control-grid-item" id="btn-right">
                        <button class="control-btn" data-command="R" disabled>‚ñ∂</button>
                    </div>
                    <div class="control-grid-item" id="btn-backward">
                        <button class="control-btn" data-command="B" disabled>‚ñº</button>
                    </div>
                </div>
            </div>
        </div>

        <div id="contact" class="page">
            <h2 style="text-align: center; margin-bottom: 20px;">Contact & Info üí¨</h2>
            
            <div class="card">
                <h3>Developer Links</h3>
                <a href="https://www.facebook.com/share/1JsBTpJPKS/" target="_blank" class="contact-link">
                    <span class="icon">üìò</span> Facebook Page
                </a>
                <a href="https://stemst159-hue.github.io/stem.github.io/" target="_blank" class="contact-link">
                    <span class="icon">üåê</span> Project Website
                </a>
            </div>
            <p style="text-align: center; margin-top: 20px; color: var(--secondary-color);">Thank you for using the RC Car Controller.</p>
        </div>
    </div>

    <nav class="nav-bar">
        <a href="#home" class="nav-item active" data-page="home">
            <span class="icon">üè†</span>
            <span>Home</span>
        </a>
        <a href="#control" class="nav-item" data-page="control">
            <span class="icon">‚öôÔ∏è</span>
            <span>Control</span>
        </a>
        <a href="#contact" class="nav-item" data-page="contact">
            <span class="icon">üìß</span>
            <span>Contact</span>
        </a>
    </nav>

    <script>
        // --- CONSTANTS AND STATE ---
        const pages = document.querySelectorAll('.page');
        const navItems = document.querySelectorAll('.nav-item');
        
        const connectButton = document.getElementById('connect-button');
        const statusDisplay = document.getElementById('status-display');
        const connectionText = document.getElementById('connection-text');
        const deviceNameDisplay = document.getElementById('device-name');
        const controlButtons = document.querySelectorAll('.control-btn');
        
        let bluetoothDevice = null;
        let bleCharacteristic = null;

        // The HC-05 is classic Bluetooth, but we're using the Web Bluetooth API 
        // which primarily targets BLE. We'll use a placeholder UUID for demonstration.
        // For actual HC-05 connection on supported browsers, no service/characteristic 
        // filtering might be needed, or a custom one must be used.
        // We use a common UART service/characteristic UUID for maximum compatibility with BLE devices.
        const UART_SERVICE_UUID = '6e400001-b5a3-f393-e0a9-e50e24dcca9e'; // nRF UART Service
        const TX_CHARACTERISTIC_UUID = '6e400002-b5a3-f393-e0a9-e50e24dcca9e'; // TX Characteristic

        // --- NAVIGATION LOGIC ---
        function changePage(pageId) {
            pages.forEach(page => {
                page.classList.remove('active');
            });
            navItems.forEach(item => {
                item.classList.remove('active');
            });

            document.getElementById(pageId).classList.add('active');
            document.querySelector(`.nav-item[data-page="${pageId}"]`).classList.add('active');
        }

        navItems.forEach(item => {
            item.addEventListener('click', (e) => {
                e.preventDefault();
                const pageId = item.getAttribute('data-page');
                changePage(pageId);
            });
        });

        // Set initial page based on URL hash (optional) or default to home
        const initialPage = window.location.hash.substring(1) || 'home';
        if (document.getElementById(initialPage)) {
            changePage(initialPage);
        }

        // --- UI/STATUS LOGIC ---
        function updateStatus(isConnected, deviceName = 'No Device Selected') {
            statusDisplay.classList.remove('status-connected', 'status-not-connected');
            connectButton.disabled = isConnected;
            
            if (isConnected) {
                statusDisplay.classList.add('status-connected');
                connectionText.textContent = 'CONNECTED';
                deviceNameDisplay.textContent = deviceName;
                controlButtons.forEach(btn => btn.disabled = false);
            } else {
                statusDisplay.classList.add('status-not-connected');
                connectionText.textContent = 'NOT CONNECTED';
                deviceNameDisplay.textContent = deviceName;
                controlButtons.forEach(btn => btn.disabled = true);
            }
        }

        // --- BLUETOOTH CORE LOGIC ---

        function displayError(message) {
            alert('Bluetooth Error: ' + message);
            console.error(message);
            updateStatus(false, 'Connection Failed');
        }

        /**
         * Converts a command character (F, B, L, R, S) into a DataView for sending.
         * @param {string} command - The single character command.
         * @returns {DataView}
         */
        function charToDataView(command) {
            let buffer = new ArrayBuffer(1);
            let view = new DataView(buffer);
            view.setUint8(0, command.charCodeAt(0));
            return view;
        }

        /**
         * Send a command over the connected Bluetooth characteristic.
         * @param {string} command - The command to send (F, B, L, R, S).
         */
        async function sendCommand(command) {
            if (!bleCharacteristic) {
                console.warn('Characteristic not available. Not sending command:', command);
                return;
            }
            try {
                const dataView = charToDataView(command);
                await bleCharacteristic.writeValue(dataView);
                console.log(`Command sent: ${command}`);
            } catch (error) {
                console.error('Failed to send command:', error);
                displayError('Failed to send command: ' + error.message);
            }
        }
        
        // --- BLUETOOTH CONNECTION FLOW ---

        async function connectBluetooth() {
            if (!('bluetooth' in navigator)) {
                displayError('Web Bluetooth API is not supported in this browser. Please use Chrome on Android.');
                return;
            }

            try {
                // Step 1: Request Bluetooth Device
                // Note: The filters are designed for common BLE devices.
                // For HC-05 (Classic), the browser might need a broader request or
                // a specific implementation detail to succeed.
                console.log('Requesting Bluetooth Device...');
                bluetoothDevice = await navigator.bluetooth.requestDevice({
                    // For HC-05 (Classic), this might need to be 'acceptAll: true'
                    // and then the device must be manually paired first.
                    // Using a general filter here.
                    filters: [
                        { namePrefix: 'HC-05' },
                        { namePrefix: 'HC-06' },
                        { services: [UART_SERVICE_UUID] },
                    ],
                    optionalServices: [UART_SERVICE_UUID]
                });

                // Attach disconnect handler
                bluetoothDevice.addEventListener('gattserverdisconnected', onDisconnect);

                // Step 2: Connect to GATT Server
                console.log('Connecting to GATT Server...');
                const server = await bluetoothDevice.gatt.connect();

                // Step 3: Get Service
                console.log('Getting Service...');
                const service = await server.getPrimaryService(UART_SERVICE_UUID);

                // Step 4: Get Characteristic
                console.log('Getting Characteristic...');
                bleCharacteristic = await service.getCharacteristic(TX_CHARACTERISTIC_UUID);

                // Connection successful
                updateStatus(true, bluetoothDevice.name || 'Unknown Device');
                console.log('Connected to device:', bluetoothDevice.name);

            } catch (error) {
                console.error('Connection failed:', error);
                if (error.name !== 'NotFoundError') { // Ignore user cancellation
                    displayError(error.message);
                }
                updateStatus(false, 'Connection Failed');
            }
        }

        function onDisconnect(event) {
            const device = event.target;
            console.log(`Device ${device.name} disconnected.`);
            updateStatus(false, `${device.name || 'Device'} Disconnected`);
            bluetoothDevice = null;
            bleCharacteristic = null;
        }

        // --- EVENT LISTENERS ---
        
        // 1. Connection Button Listener
        connectButton.addEventListener('click', connectBluetooth);

        // 2. Control Buttons Listeners (Handles both press and release)
        controlButtons.forEach(button => {
            const command = button.getAttribute('data-command');
            
            // Send command on button press (touchstart/mousedown)
            const handleStart = (e) => {
                e.preventDefault(); // Prevent touch-scrolling on mobile
                if (button.disabled) return;
                sendCommand(command);
            };

            // Send 'S' (Stop) command on button release (touchend/mouseup/mouseleave)
            const handleEnd = (e) => {
                // Check if the current command is NOT 'S' (we don't want to stop after pressing 'S')
                if (command !== 'S' && !button.disabled) {
                    sendCommand('S'); 
                }
            };
            
            // For mobile (touch devices)
            button.addEventListener('touchstart', handleStart);
            button.addEventListener('touchend', handleEnd);
            button.('touchcancel', handleEnd);

            // For desktop/mouse devices
            button.addEventListener('mousedown', handleStart);
            button.addEventListener('mouseup', handleEnd);
            button.addEventListener('mouseleave', handleEnd); 
        });

        // --- INITIAL CHECK ---
        // Check        }

        /* --- Hero/3D Section (Stylish Stems) --- */
        .hero-3d {
            height: 70vh; 
            background-color: var(--color-bg-dark); 
            display: flex;
            align-items: center;
            justify-content: center;
            position: relative;
            overflow: hidden;
            /* Aesthetic "stems" background effect using subtle repeated lines */
            background-image: radial-gradient(circle at center, rgba(255, 4, 4, 0.1), rgba(11, 1, 1, 0.8)),
                              repeating-linear-gradient(0deg, #6d6969 0, #3a3a3a 1px, #561a1a 2px);
            border-bottom: 3px solid var(--color-primary);
        }

        #threejs-container {
            width: 100%;
            height: 100%;
            color: white;
            text-align: center;
            padding-top: 15%; 
        }

        h1 {
            font-size: 4em;
            margin-bottom: 10px;
            font-weight: 700;
            text-shadow: 0 0 10px rgba(0, 188, 212, 0.5);
        }

        /* --- General Tool Section Styling --- */
        .tool-section {
            padding: 40px 0;
        }

        .section-divider {
            border: none;
            height: 1px;
            background-color: var(--color-border);
            margin: 20px 0;
        }

        .section-divider-small {
            border: none;
            height: 1px;
            background-color: var(--color-border);
            margin: 15px 0;
        }

        h2 {
            font-size: 2.5em;
            color: var(--color-primary);
            margin-bottom: 25px;
            border-left: 6px solid var(--color-primary);
            padding-left: 15px;
            font-weight: 300;
        }

        .tool-content {
            background-color: var(--color-card);
            padding: 30px;
            border-radius: 10px;
            box-shadow: var(--box-shadow);
        }

        /* Button Base Styles */
        button {
            border: none;
            padding: 12px 15px;
            border-radius: 5px;
            cursor: pointer;
            font-weight: 600;
            transition: all 0.2s;
            text-transform: uppercase;
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.2);
        }

        /* --- Connect Tool Styling --- */
        .connection-status {
            text-align: center;
            margin-bottom: 20px;
        }

        #connection-state {
            font-size: 1.5em;
            font-weight: 700;
            padding: 10px 20px;
            border-radius: 5px;
            color: var(--color-bg-dark);
            display: inline-block; /* Added for proper padding and background */
        }

        .disconnected {
            background-color: var(--color-danger);
            animation: blink-red 2s infinite;
        }

        .connected {
            background-color: var(--color-success);
            animation: none;
        }

        @keyframes blink-red {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.7; }
        }

        .connection-options {
            display: flex;
            gap: 20px;
            margin-bottom: 20px;
        }

        .connect-btn {
            flex-grow: 1;
            color: white;
            background-color: var(--color-secondary); /* Bluetooth color */
        }

        .connect-btn:hover {
            background-color: #d17500;
        }

        .danger-btn {
            background-color: #616161; /* Disconnect button (greyed out when disabled) */
            color: white;
        }

        .danger-btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
            transform: none;
            box-shadow: none;
        }
        .bluetooth-note {
            font-size: 0.9em;
            opacity: 0.7;
            margin-top: 10px;
        }

        /* --- Video Placeholder --- */
        .video-placeholder {
            background-color: #000;
            height: 450px;
            border-radius: 8px;
            color: white;
            display: flex;
            align-items: center;
            justify-content: center;
            font-style: italic;
            font-size: 1.5em;
            border: 1px solid var(--color-primary);
        }

        /* --- Control Tool Specific Layout --- */
        .control-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 40px;
        }

        .control-panel {
            border: 1px solid var(--color-border);
            padding: 20px;
            border-radius: 8px;
        }

        h3 {
            color: var(--color-secondary);
            margin-bottom: 15px;
            border-bottom: 1px solid var(--color-border);
            padding-bottom: 10px;
        }

        .action-btn {
            flex-grow: 1;
            background-color: var(--color-secondary);
            color: var(--color-bg-dark);
        }

        .move-btn {
            background-color: var(--color-text);
            color: var(--color-bg-dark);
        }
        
        /* D-Pad Styling */
        .dpad-container {
            /* Use CSS Grid for the 3x3 layout */
            display: grid;
            grid-template-columns: repeat(3, 70px); /* Larger for mobile tap targets */
            grid-template-rows: repeat(3, 70px);
            grid-template-areas:
                ". up ."
                "left center right"
                ". down .";
            width: 210px; /* Overall width */
            height: 210px; /* Overall height */
            margin: 20px auto; /* Center on control panel */
        }

        .dpad-button {
            /* Common styling for all buttons */
            background-color: #3b82f6; /* Blue background */
            border-radius: 50%; /* Makes it circular */
            display: flex;
            justify-content: center;
            align-items: center;
            color: #cccccc; /* Light gray color for the arrow */
            font-size: 1.5em;
            font-weight: bold;
            cursor: pointer;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.4);
            transition: background-color 0.1s;
        }

        .dpad-button:active {
            box-shadow: none;
            transform: translateY(2px);
        }

        /* Positioning the buttons in the grid */
        .up    { grid-area: up;    }
        .left  { grid-area: left;  }
        .right { grid-area: right; }
        .down  { grid-area: down;  }

        /* --- New Controller Styles --- */
        /* Custom styles for the circular buttons and centering - Merged from new controller */
        .circle-button {
            width: 80px;
            height: 80px;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 9999px; /* Full circle */
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1), 0 1px 3px rgba(0, 0, 0, 0.08);
            transition: transform 0.1s, box-shadow 0.1s;
            background-color: #3b82f6; /* Blue-600 */
        }

        .pill-button {
            padding: 0.75rem 2.5rem;
            border-radius: 9999px;
            font-weight: 700;
            text-transform: uppercase;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1), 0 1px 3px rgba(0, 0, 0, 0.08);
            transition: transform 0.1s, box-shadow 0.1s;
            min-width: 150px; /* Ensure they are wide like in the image */
            color: white; /* Ensure text is white */
        }
        
        /* Active/Pressed state visual feedback */
        .circle-button:active, .pill-button:active {
            transform: scale(0.95);
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
        }

        /* SVG Arrow styles for better visibility */
        .arrow-icon {
            fill: white;
            width: 30px;
            height: 30px;
        }
        
        /* Red and Green button colors */
        #btn-stop { background-color: var(--color-danger); } /* Red */
        #btn-start { background-color: var(--color-success); } /* Green */
        #btn-stop:hover { background-color: #c62828; }
        #btn-start:hover { background-color: #388e3c; }

        /* General Controller Wrapper */
        .controller-wrapper {
            /* Inherit background from tool-content, no need for controller-bg */
            padding: 20px;
            border-radius: 10px;
        }

        /* Status Display Styling */
        .status-display {
            margin-bottom: 20px;
            padding: 10px;
            background-color: var(--color-bg-dark); /* Dark background for status */
            border-radius: 8px;
            text-align: center;
            box-shadow: inset 0 1px 3px rgba(0, 0, 0, 0.5);
        }
        .status-display p {
            margin: 5px 0;
        }
        #command-status {
            font-size: 1.8em;
            font-weight: 700;
            letter-spacing: 1px;
        }
        /* End of New Controller Styles */


        /* Footer */
        footer {
            text-align: center;
            padding: 20px;
            background-color: var(--color-card);
            border-top: 1px solid var(--color-primary);
            margin-top: 20px;
            opacity: 0.8;
        }
        
        /* Mobile-Specific Overrides */
        @media (max-width: 800px) {
            header {
                flex-direction: column;
                padding: 15px 20px;
            }
            nav ul {
                margin: 10px 0;
            }
            .controls {
                margin-top: 10px;
            }
            .container {
                padding: 10px;
            }
            h1 {
                font-size: 3em;
            }
            /* Adjusted for the new controller layout */
            .main-controller-grid {
                grid-template-columns: 1fr; /* Stack columns on small screens */
            }
            .connection-options {
                flex-direction: column;
            }
            .dpad-container {
                /* Keep D-Pad centered and large for easy tapping */
                grid-template-columns: repeat(3, 60px);
                grid-template-rows: repeat(3, 60px);
                width: 180px;
                height: 180px;
            }
            .pill-button {
                min-width: 120px;
                padding: 0.75rem 1.5rem;
            }
        }
    </style>
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
        // Keeping Tailwind config for the controller's utility classes like 'text-yellow-400'
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        // Re-defining controller-bg here is not strictly necessary as we use existing CSS, 
                        // but keeping the config structure is safe.
                        'controller-bg': '#14532d', 
                    },
                    fontFamily: {
                        sans: ['Inter', 'sans-serif'],
                    },
                }
            }
        }
    </script>
</head>
<body class="light-mode">
    <header>
        <div class="logo"> <img src="stemwebsite/photo_2025-11-11_20-08-29-removebg-preview.png"> T4S</div>
        <nav>
            <ul>
                
                <li><a href="#video-tool" data-i18n="nav_video">Video </a></li>
                <li><a href="#control-tool" data-i18n="nav_control">Control</a></li>
                <li><a href="#connect-tool" data-i18n="nav_connect">Connect</a></li> </ul>
        </nav>
        <div class="controls">
            <select id="language-switcher">
                <option value="en">English</option>
                <option value="kh">·ûÅ·üí·ûò·üÇ·ûö</option>
            </select>
            <button id="mode-toggle" aria-label="Toggle dark/light mode">
                ‚òÄÔ∏è
            </button>
        </div>
    </header>

    <section id="hero" class="hero-3d">
        <div id="threejs-container">
            <h1 data-i18n="hero_title">ST STEM</h1>
            <p data-i18n="hero_subtitle">Controller</p>
        </div>
    </section>

    
<head>
     <section id="connect-tool" class="tool-section"></section>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Bluetooth Connect</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      text-align: center;
      margin-top: 100px;
      background-color: #000000;
    }
    button {
      background: #0078d7;
      color: rgb(0, 0, 0);
      border: none;
      padding: 15px 30px;
      border-radius: 8px;
      font-size: 18px;
      cursor: pointer;
    }
    button:hover {
      background: #005fa3;
    }
    #status {
      margin-top: 20px;
      font-size: 18px;
    }
  </style>
</head>
<body>
 <button id="connect-hm10">Connect HM-10 (BLE)</button>
<button id="connect-hc05">Connect HC-05 (Serial)</button>
<p id="bt-status">Status: Not connected</p>

<script>
let bleDevice = null;
let bleCharacteristic = null;
let serialPort = null;
let serialWriter = null;

// --- HM-10 BLE Connect ---
document.getElementById('connect-hm10').addEventListener('click', async () => {
    try {
        bleDevice = await navigator.bluetooth.requestDevice({
            filters: [{ namePrefix: 'HM' }], // matches HM-10 default names
            optionalServices: ['0000ffe0-0000-1000-8000-00805f9b34fb'] // HM-10 service UUID
        });
        const server = await bleDevice.gatt.connect();
        const service = await server.getPrimaryService('0000ffe0-0000-1000-8000-00805f9b34fb');
        bleCharacteristic = await service.getCharacteristic('0000ffe1-0000-1000-8000-00805f9b34fb');
        document.getElementById('bt-status').textContent = `Connected to HM-10: ${bleDevice.name}`;
    } catch (err) {
        console.error(err);
        document.getElementById('bt-status').textContent = 'BLE Connection Failed';
    }
});

// --- HC-05 Serial Connect ---
document.getElementById('connect-hc05').addEventListener('click', async () => {
    try {
        serialPort = await navigator.serial.requestPort();
        await serialPort.open({ baudRate: 9600 });
        serialWriter = serialPort.writable.getWriter();
        document.getElementById('bt-status').textContent = 'Connected to HC-05';
    } catch (err) {
        console.error(err);
        document.getElementById('bt-status').textContent = 'Serial Connection Failed';
    }
});

// --- Send Commands ---
async function sendCommand(cmd) {
    if (bleCharacteristic) {
        const data = new TextEncoder().encode(cmd);
        await bleCharacteristic.writeValue(data);
        console.log('Sent via HM-10:', cmd);
    }
    if (serialWriter) {
        await serialWriter.write(new TextEncoder().encode(cmd));
        console.log('Sent via HC-05:', cmd);
    }
}

// Example: Hooking buttons
document.getElementById('btn-forward').addEventListener('click', () => sendCommand('F'));
document.getElementById('btn-backward').addEventListener('click', () => sendCommand('B'));
document.getElementById('btn-left').addEventListener('click', () => sendCommand('L'));
document.getElementById('btn-right').addEventListener('click', () => sendCommand('R'));
document.getElementById('btn-start').addEventListener('click', () => sendCommand('S'));
document.getElementById('btn-stop').addEventListener('click', () => sendCommand('X'));
</script>

        </section>
        
  

    </section>

    <hr class="section-divider">

    <section id="video-tool" class="tool-section">
        <h2 data-i18n="sec_video_title">Video üé•</h2>
        <style>
        /* ·ûÄ·ûª·ûÑ·ûè·û∫·ûì·üê·ûö·ûü·ûò·üí·ûö·û∂·ûî·üã·ûä·û∂·ûÄ·üã·ûú·û∏·ûä·üÅ·û¢·ûº·ûë·û∂·üÜ·ûÑ·ûñ·û∏·ûö */
        .video-container {
            display: flex;        /* ·ûî·üí·ûö·ûæ Flexbox ·ûä·ûæ·ûò·üí·ûî·û∏·ûä·û∂·ûÄ·üã·ûú·û∏·ûä·üÅ·û¢·ûº·ûá·û∂·ûî·üã·ûÇ·üí·ûì·û∂ */
            gap: 20px;            /* ·ûÄ·üÜ·ûé·ûè·üã·ûÇ·ûò·üí·ûõ·û∂·ûè·ûö·ûú·û∂·ûÑ·ûú·û∏·ûä·üÅ·û¢·ûº·ûë·û∂·üÜ·ûÑ·ûñ·û∏·ûö: 2cm = 20px */
            padding: 20px;        /* ·ûî·ûì·üí·ûê·üÇ·ûò padding ·ûÅ·üí·ûõ·üá·ûü·ûò·üí·ûö·û∂·ûî·üã·ûò·ûæ·ûõ·ûÑ·û∂·ûô */
            border: 1px solid #ccc; /* ·ûÇ·üí·ûö·û∂·ûì·üã·ûè·üÇ·ûá·û∂·ûî·ûì·üí·ûë·û∂·ûè·üã·ûü·ûò·üí·ûö·û∂·ûî·üã·ûò·ûæ·ûõ·ûñ·üí·ûö·üÜ·ûä·üÇ·ûì */
        }
        
        /* ·ûÄ·üÜ·ûé·ûè·üã·ûõ·ûÄ·üí·ûÅ·ûé·üà·ûú·û∏·ûä·üÅ·û¢·ûº */
        .video-container video {
            /* ·ûò·û∑·ûì·ûÖ·û∂·üÜ·ûî·û∂·ûÖ·üã·ûÄ·üÜ·ûé·ûè·üã width/height ·û°·ûæ·ûÑ·ûú·û∑·ûâ·ûë·üÅ ·ûñ·üí·ûö·üÑ·üá·ûò·û∂·ûì·ûÄ·üí·ûì·ûª·ûÑ HTML attribute ·ûö·ûΩ·ûÖ·û†·ûæ·ûô */
            box-shadow: 2px 2px 5px rgba(0, 0, 0, 0.2); /* ·ûü·üí·ûö·ûò·üÑ·ûõ·ûî·ûì·üí·ûè·û∑·ûÖ·ûî·ûì·üí·ûè·ûΩ·ûÖ */
        }
    </style>
</head>
<body>

    <div class="video-container">
        <video id="robot-video-1" 
               src="IMG_4159.MOV" 
               type="video/quicktime" 
               controls 
               loop 
               muted 
               autoplay 
               width="500px" 
               height="500px"
        >
            Your browser does not support the video tag.
        </video>
        
        <video id="robot-video-2" 
               src="IMG_4159.MOV" 
               type="video/quicktime" 
               controls 
               loop 
               muted 
               autoplay 
               width="500px" 
               height="500px"
        >
            Your browser does not support the video tag.
        </video>
         <video id="robot-video-2" 
               src="IMG_4159.MOV" 
               type="video/quicktime" 
               controls 
               loop 
               muted 
               autoplay 
               width="500px" 
               height="500px"
        >
            Your browser does not support the video tag.
        </video>
        
    </div>
    </video>
         <style>
        /* ·ûÄ·ûª·ûÑ·ûè·û∫·ûì·üê·ûö·ûü·ûò·üí·ûö·û∂·ûî·üã·ûä·û∂·ûÄ·üã·ûú·û∏·ûä·üÅ·û¢·ûº·ûë·û∂·üÜ·ûÑ·ûñ·û∏·ûö */
        .video-container {
            display: flex;        /* ·ûî·üí·ûö·ûæ Flexbox ·ûä·ûæ·ûò·üí·ûî·û∏·ûä·û∂·ûÄ·üã·ûú·û∏·ûä·üÅ·û¢·ûº·ûá·û∂·ûî·üã·ûÇ·üí·ûì·û∂ */
            gap: 20px;            /* ·ûÄ·üÜ·ûé·ûè·üã·ûÇ·ûò·üí·ûõ·û∂·ûè·ûö·ûú·û∂·ûÑ·ûú·û∏·ûä·üÅ·û¢·ûº·ûë·û∂·üÜ·ûÑ·ûñ·û∏·ûö: 2cm = 20px */
            padding: 20px;        /* ·ûî·ûì·üí·ûê·üÇ·ûò padding ·ûÅ·üí·ûõ·üá·ûü·ûò·üí·ûö·û∂·ûî·üã·ûò·ûæ·ûõ·ûÑ·û∂·ûô */
            border: 1px solid #ccc; /* ·ûÇ·üí·ûö·û∂·ûì·üã·ûè·üÇ·ûá·û∂·ûî·ûì·üí·ûë·û∂·ûè·üã·ûü·ûò·üí·ûö·û∂·ûî·üã·ûò·ûæ·ûõ·ûñ·üí·ûö·üÜ·ûä·üÇ·ûì */
        }
        
        /* ·ûÄ·üÜ·ûé·ûè·üã·ûõ·ûÄ·üí·ûÅ·ûé·üà·ûú·û∏·ûä·üÅ·û¢·ûº */
        .video-container video {
            /* ·ûò·û∑·ûì·ûÖ·û∂·üÜ·ûî·û∂·ûÖ·üã·ûÄ·üÜ·ûé·ûè·üã width/height ·û°·ûæ·ûÑ·ûú·û∑·ûâ·ûë·üÅ ·ûñ·üí·ûö·üÑ·üá·ûò·û∂·ûì·ûÄ·üí·ûì·ûª·ûÑ HTML attribute ·ûö·ûΩ·ûÖ·û†·ûæ·ûô */
            box-shadow: 2px 2px 5px rgba(0, 0, 0, 0.2); /* ·ûü·üí·ûö·ûò·üÑ·ûõ·ûî·ûì·üí·ûè·û∑·ûÖ·ûî·ûì·üí·ûè·ûΩ·ûÖ */
        }
    </style>
</head>
<body>

    <div class="video-container">
        <video id="robot-video-1" 
               src="IMG_4159.MOV" 
               type="video/quicktime" 
               controls 
               loop 
               muted 
               autoplay 
               width="500px" 
               height="500px"
        >
            Your browser does not support the video tag.
        </video>
        <video id="robot-video-1" 
               src="IMG_4159.MOV" 
               type="video/quicktime" 
               controls 
               loop 
               muted 
               autoplay 
               width="500px" 
               height="500px"
        >
            Your browser does not support the video tag.
        </video><video id="robot-video-1" 
               src="IMG_4159.MOV" 
               type="video/quicktime" 
               controls 
               loop 
               muted 
               autoplay 
               width="500px" 
               height="500px"
        >
            Your browser does not support the video tag.
        </video>
        
    </section>

    <hr class="section-divider">

    <section id="control-tool" class="tool-section">
        <h2 data-i18n="sec_control_title">Control Tool üéÆ</h2>
        <div class="tool-content controller-wrapper">

            <div class="status-display">
                <p class="text-sm text-gray-300">Current Command:</p>
                <p id="command-status" class="text-2xl font-extrabold text-green-400">WAITING FOR INPUT</p>
            </div>

            <div class="main-controller-grid grid grid-cols-1 md:grid-cols-3 gap-8 items-center">

                <div class="flex flex-col items-center space-y-4">
                    <button id="btn-forward" class="circle-button hover:bg-blue-700" data-command="forward">
                        <svg class="arrow-icon" viewBox="0 0 24 24">
                            <path d="M7 14l5-5 5 5z" fill="white"/>
                        </svg>
                    </button>
                    <div class="text-xs font-semibold text-gray-300"></div>
                    <button id="btn-backward" class="circle-button hover:bg-blue-700" data-command="backward">
                        <svg class="arrow-icon" viewBox="0 0 24 24">
                            <path d="M7 10l5 5 5-5z" fill="white"/>
                        </svg>
                    </button>
                    <div class="text-xs font-semibold text-gray-300"></div>
                </div>

                <div class="flex flex-col items-center space-y-4 justify-center py-6 order-last md:order-none">
                    <button id="btn-stop" class="pill-button w-full" data-action="stop">
                        STOP
                    </button>
                    <button id="btn-start" class="pill-button w-full" data-action="start">
                        START
                    </button>
                </div>

                <div class="flex items-center justify-center space-x-6">
                    <button id="btn-left" class="circle-button hover:bg-blue-700" data-command="left">
                        <svg class="arrow-icon" viewBox="0 0 24 24">
                            <path d="M14 7l-5 5 5 5z" fill="white"/>
                        </svg>
                    </button>
                    <div class="text-xs font-semibold text-gray-300"></div>

                    <div class="text-xs font-semibold text-gray-300"></div>
                    <button id="btn-right" class="circle-button hover:bg-blue-700" data-command="right">
                        <svg class="arrow-icon" viewBox="0 0 24 24">
                            <path d="M10 7l5 5-5 5z" fill="white"/>
                        </svg>
                    </button>
                </div>
            </div>
        </div>
    </section>
    <footer>
        <p>&copy; Stung treng.</p>
    </footer>

    <script>
        // --- Merged script.js content (Original file) ---
        document.addEventListener('DOMContentLoaded', () => {
            const body = document.body;
            const modeToggle = document.getElementById('mode-toggle');
            const langSwitcher = document.getElementById('language-switcher');
            // Check for existence of connect buttons before assigning to avoid null errors on page load
            const connectBluetoothBtn = document.getElementById('connect-bluetooth-btn');
            const disconnectBluetoothBtn = document.getElementById('disconnect-bluetooth-btn');
            const connectionState = document.getElementById('connection-state');

            // --- 1. Language Data Structure ---
            const translations = {
                en: {
                    title: "Stemkits controller", // Corrected title
                    nav_video: "Video",
                    nav_control: "Control",
                    nav_connect: "Connect",
                    hero_title: "ST STEM",
                    hero_subtitle: "Controller",
                    sec_connect_title: "Connection üì°",
                    sec_connect_desc: "Establish a secure connection to the robot arm via Web Bluetooth for direct mobile control.",
                    btn_connect_bluetooth: "Connect via Bluetooth (Mobile Controller)",
                    btn_disconnect_bluetooth: "Disconnect",
                    bluetooth_note: "*Requires HTTPS and a browser supporting the Web Bluetooth API (e.g., Chrome, Edge).",
                    status_disconnected: "Status: Disconnected",
                    status_connected: "Status: Connected",
                    sec_video_title: "Video üé•", // Corrected title
                    sec_video_desc: "connect with robot.",
                    sec_control_title: "Control Tool üéÆ",
                
                },
                kh: {
                    title: "·ûÄ·ûò·üí·ûò·ûú·û∑·ûí·û∏·ûÇ·üí·ûö·ûî·üã·ûÇ·üí·ûö·ûÑ·ûß·ûî·ûÄ·ûö·ûé·üç Stemkits", // Added Kh title
                    nav_video: "·ûß·ûî·ûÄ·ûö·ûé·üç·ûú·û∏·ûä·üÅ·û¢·ûº", 
                    nav_control: "·ûß·ûî·ûÄ·ûö·ûé·üç·ûî·ûâ·üí·ûá·û∂", 
                    nav_connect: "·ûó·üí·ûá·û∂·ûî·üã",
                    hero_title: "ST STEM", 
                    hero_subtitle: "·ûî·ûâ·üí·ûá·û∂", 
                    sec_connect_title: "·ûÄ·ûò·üí·ûò·ûú·û∑·ûí·û∏·ûÇ·üí·ûö·ûî·üã·ûÇ·üí·ûö·ûÑ·ûÄ·û∂·ûö·ûè·ûó·üí·ûá·û∂·ûî·üã üì°",
                    sec_connect_desc: "·ûî·ûÑ·üí·ûÄ·ûæ·ûè·ûÄ·û∂·ûö·ûè·ûó·üí·ûá·û∂·ûî·üã·ûä·üÇ·ûõ·ûò·û∂·ûì·ûü·ûª·ûú·ûè·üí·ûê·û∑·ûó·û∂·ûñ·ûë·üÖ·ûÄ·û∂·ûì·üã·ûä·üÉ·ûö·üâ·ûº·ûî·ûº·ûè·ûè·û∂·ûò·ûö·ûô·üà Web Bluetooth ·ûü·ûò·üí·ûö·û∂·ûî·üã·ûÄ·û∂·ûö·ûÇ·üí·ûö·ûî·üã·ûÇ·üí·ûö·ûÑ·ûä·üÑ·ûô·ûï·üí·ûë·û∂·ûõ·üã·üî",
                    btn_connect_bluetooth: "·ûó·üí·ûá·û∂·ûî·üã·ûè·û∂·ûò·ûö·ûô·üà·ûî·üä·üí·ûõ·ûº·ûí·ûº·ûü (·ûß·ûî·ûÄ·ûö·ûé·üç·ûî·ûâ·üí·ûá·û∂·ûÖ·ûõ·üê·ûè)",
                    btn_disconnect_bluetooth: "·ûï·üí·ûè·û∂·ûÖ·üã",
                    bluetooth_note: "*·ûë·û∂·ûò·ûë·û∂·ûö HTTPS ·ûì·û∑·ûÑ·ûÄ·ûò·üí·ûò·ûú·û∑·ûí·û∏·ûö·ûª·ûÄ·ûö·ûÄ·ûä·üÇ·ûõ·ûÇ·û∂·üÜ·ûë·üí·ûö Web Bluetooth API (·ûä·ûº·ûÖ·ûá·û∂ Chrome, Edge)·üî",
                    status_disconnected: "·ûü·üí·ûê·û∂·ûì·ûó·û∂·ûñ: ·ûï·üí·ûè·û∂·ûÖ·üã",
                    status_connected: "·ûü·üí·ûê·û∂·ûì·ûó·û∂·ûñ: ·ûó·üí·ûá·û∂·ûî·üã",
                    sec_video_title: "·ûß·ûî·ûÄ·ûö·ûé·üç·ûú·û∏·ûä·üÅ·û¢·ûº üé•",
                    sec_video_desc: "·ûó·üí·ûá·û∂·ûî·üã·ûë·üÖ·ûÄ·û∂·ûì·üã robot·üî",
                    sec_control_title: "·ûß·ûî·ûÄ·ûö·ûé·üç·ûî·ûâ·üí·ûá·û∂ üéÆ",
                },
            
            };

            // --- 2. Dark/Light Mode Toggle ---
            const currentMode = localStorage.getItem('mode') || 'dark';
            body.className = currentMode + '-mode';
            modeToggle.textContent = currentMode === 'dark' ? '‚òÄÔ∏è' : 'üåô';

            modeToggle.addEventListener('click', () => {
                const newMode = body.classList.contains('light-mode') ? 'dark' : 'light';
                body.className = newMode + '-mode';
                modeToggle.textContent = newMode === 'dark' ? '‚òÄÔ∏è' : 'üåô';
                localStorage.setItem('mode', newMode);
            });

            // --- 3. Localization Functionality ---
            const setLanguage = (lang) => {
                const elements = document.querySelectorAll('[data-i18n]');
                const texts = translations[lang];
                if (!texts) return;

                elements.forEach(el => {
                    const key = el.getAttribute('data-i18n');
                    if (texts[key]) {
                        if (key === 'title') {
                            document.title = texts[key];
                        } 
                        else if (el.tagName !== 'SELECT') { // Exclude the SELECT element itself
                            el.textContent = texts[key];
                        }

                        // Special handling for button text/status text
                        if (el.id === 'connection-state' && connectionState) {
                             // Update the status text based on current connection state
                             const isConnected = el.classList.contains('connected');
                             el.textContent = isConnected ? texts['status_connected'] : texts['status_disconnected'];
                        } else if (el.id === 'connect-bluetooth-btn' && connectBluetoothBtn) {
                            // Ensure button text is set
                            connectBluetoothBtn.textContent = texts['btn_connect_bluetooth'];
                        } else if (el.id === 'disconnect-bluetooth-btn' && disconnectBluetoothBtn) {
                            // Ensure button text is set
                            disconnectBluetoothBtn.textContent = texts['btn_disconnect_bluetooth'];
                        }
                    }
                });
                localStorage.setItem('lang', lang);
            };

            langSwitcher.value = localStorage.getItem('lang') || 'en';
            setLanguage(langSwitcher.value);

            langSwitcher.addEventListener('change', (event) => {
                setLanguage(event.target.value);
            });
            
            // --- Connection Status UI Update Function ---
            const updateConnectionState = (isConnected) => {
                if (!connectionState) return; // Guard for null element
                const lang = langSwitcher.value;
                const texts = translations[lang];

                if (isConnected) {
                    connectionState.classList.remove('disconnected');
                    connectionState.classList.add('connected');
                    connectionState.textContent = texts['status_connected'];
                    if(connectBluetoothBtn) connectBluetoothBtn.disabled = true;
                    if(disconnectBluetoothBtn) disconnectBluetoothBtn.disabled = false;
                } else {
                    connectionState.classList.remove('connected');
                    connectionState.classList.add('disconnected');
                    connectionState.textContent = texts['status_disconnected'];
                    if(connectBluetoothBtn) connectBluetoothBtn.disabled = false;
                    if(disconnectBluetoothBtn) disconnectBluetoothBtn.disabled = true;
                }
            };


            // --- 4. Web Bluetooth Connection Logic (Mock/Placeholder) ---
            let bluetoothDevice = null;
            let controlCharacteristic = null; // GATT characteristic for sending commands

            // MOCK/PLACEHOLDER: Replace with actual Web Bluetooth API logic
            const connectBluetooth = async () => {
                 console.log('Attempting to connect via Web Bluetooth...');
                 updateConnectionState(true); // Mock successful connection
            };

            const disconnectBluetooth = () => {
                console.log('Disconnecting from Bluetooth...');
                updateConnectionState(false); // Mock disconnection
            };
            
            if (connectBluetoothBtn) connectBluetoothBtn.addEventListener('click', connectBluetooth);
            if (disconnectBluetoothBtn) disconnectBluetoothBtn.addEventListener('click', disconnectBluetooth);
            
            // Initial state setup
            updateConnectionState(false); 


            // --- 5. D-Pad Control Logic (Continuous command placeholder) ---
            const dpadButtons = document.querySelectorAll('.dpad-button');
            
            const sendCommand = (commandKey) => {
                // This original logic seems to be for a different D-pad. 
                // We'll keep the new controller's logic below for the integrated buttons.
                console.log(`Sending command: ${commandKey}`);
            }
            
            // This is the old D-Pad logic from the original index.html file. 
            // It is kept for completeness but is likely not needed now.
            /*
            dpadButtons.forEach(button => {
                // Use mousedown and touchstart for continuous action
                button.addEventListener('mousedown', (e) => {
                    const commandKey = button.getAttribute('data-command');
                    sendCommand(commandKey);
                });
                
                button.addEventListener('touchstart', (e) => {
                    e.preventDefault(); // Prevent mobile scrolling/default action
                    const commandKey = button.getAttribute('data-command');
                    sendCommand(commandKey);
                });

                // Use mouseup, mouseleave, and touchend for sending a 'STOP' command
                const stopEvent = () => {
                     sendCommand('CMD_STOP'); // Placeholder stop command
                };

                button.addEventListener('mouseup', stopEvent);
                button.addEventListener('mouseleave', stopEvent);
                button.addEventListener('touchend', stopEvent);
            });
            */
        });

        // --- Controller Script Content (from the second file) ---

        // Global state for tracking the engine status (optional, but good practice)
        let isEngineRunning = false;

        /**
         * Updates the status display on the screen.
         * @param {string} message - The command message to display.
         * @param {string} color - Tailwind color class for the text.
         */
        function updateStatus(message, color = 'text-green-400') {
            const statusElement = document.getElementById('command-status');
            if (!statusElement) return;

            statusElement.textContent = message;
            // Clear previous color classes
            // We use standard CSS classes now, so clear based on common text color prefixes
            statusElement.className = statusElement.className.split(' ').filter(cls => !cls.startsWith('text-')).join(' ');
            // Add new color class (using Tailwind classes included via the script tag)
            statusElement.classList.add(color);
        }

        /**
         * Simulates sending a movement command.
         * @param {string} direction - 'forward', 'backward', 'left', or 'right'.
         */
        function handleMoveCommand(direction) {
            if (!isEngineRunning && direction !== 'stop') {
                updateStatus('Engine is OFF. Press START first!', 'text-yellow-400');
                return;
            }

            let message;
            // let command_url; // In a real app, this would be the URL to the IoT device

            switch (direction) {
                case 'forward':
                    message = 'MOVING FORWARD';
                    // command_url = '/api/move?dir=forward';
                    break;
                case 'backward':
                    message = 'MOVING BACKWARD';
                    // command_url = '/api/move?dir=backward';
                    break;
                case 'left':
                    message = 'TURNING LEFT';
                    // command_url = '/api/move?dir=left';
                    break;
                case 'right':
                    message = 'TURNING RIGHT';
                    // command_url = '/api/move?dir=right';
                    break;
                default:
                    message = 'Invalid Movement Command';
                    return;
            }

            updateStatus(message, 'text-blue-400');
            // console.log(`[API Call] Sending: ${command_url}`); // Uncomment for real use
        }

        /**
         * Simulates sending the START or STOP command.
         * @param {string} action - 'start' or 'stop'.
         */
        function handleEngineAction(action) {
            if (action === 'start') {
                if (!isEngineRunning) {
                    isEngineRunning = true;
                    updateStatus('ENGINE STARTED! Ready to drive.', 'text-green-400');
                    // console.log('[API Call] Sending: /api/engine?action=start');
                } else {
                    updateStatus('Engine is already running.', 'text-green-500');
                }
            } else if (action === 'stop') {
                if (isEngineRunning) {
                    isEngineRunning = false;
                    updateStatus('ENGINE STOPPED.', 'text-red-400');
                    // console.log('[API Call] Sending: /api/engine?action=stop');
                } else {
                    updateStatus('Engine is already stopped.', 'text-red-500');
                }
            }
        }


        // --- Event Handlers (Controller) ---

        // 1. On-Screen Button Listeners
        function setupButtonListeners() {
            document.querySelectorAll('[data-command]').forEach(button => {
                button.addEventListener('click', () => {
                    handleMoveCommand(button.dataset.command);
                });
            });

            const startBtn = document.getElementById('btn-start');
            const stopBtn = document.getElementById('btn-stop');

            if (startBtn) startBtn.addEventListener('click', () => {
                handleEngineAction('start');
            });
            if (stopBtn) stopBtn.addEventListener('click', () => {
                handleEngineAction('stop');
            });
        }

        // 2. Keyboard Listeners (W, A, S, D)
        const keyMap = {
            'w': 'forward',
            's': 'backward',
            'a': 'left',
            'd': 'right',
            'W': 'forward',
            'S': 'backward',
            'A': 'left',
            'D': 'right',
            // Also map arrow keys for convenience
            'ArrowUp': 'forward',
            'ArrowDown': 'backward',
            'ArrowLeft': 'left',
            'ArrowRight': 'right',
            'Enter': 'start', // Start with Enter
            'Escape': 'stop'  // Stop with Escape
        };

        let activeKey = null; // To prevent rapid-fire repeated commands on hold

        window.addEventListener('keydown', (event) => {
            const command = keyMap[event.key];

            if (command && command !== activeKey) {
                event.preventDefault(); // Prevent default browser action (like scrolling)
                activeKey = command;

                if (command === 'start') {
                    handleEngineAction('start');
                } else if (command === 'stop') {
                    handleEngineAction('stop');
                } else {
                    // Check if a move button exists and visually highlight it
                    const button = document.getElementById(`btn-${command}`);
                    if (button) {
                        // Using the :active pseudo-class in CSS is better for click/touch,
                        // but for keyboard, we manually add classes simulating the pressed state
                        button.classList.add('scale-95'); // Tailwind class for scale
                        button.style.boxShadow = 'none'; // Clear box shadow on press
                    }
                    handleMoveCommand(command);
                }
            }
        });

        window.addEventListener('keyup', (event) => {
            const command = keyMap[event.key];

            if (command) {
                // Clear active key only if it was the one released
                if (command === activeKey) {
                    activeKey = null;
                }
                 // Remove visual highlight from move buttons
                const button = document.getElementById(`btn-${command}`);
                if (button) {
                    button.classList.remove('scale-95');
                    button.style.boxShadow = ''; // Restore box shadow
                }
            }
        });

        // --- Initialization ---
        window.onload = function() {
            setupButtonListeners();
            updateStatus('Press START or W/A/S/D to drive!', 'text-gray-300');
        };
    </script>
</body>

</html>
