<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>RC Car Controller</title>
    <meta name="description" content="Control your Arduino RC car using Bluetooth from your phone">
    <meta name="theme-color" content="#1e3a8a">

    <!-- Bootstrap 5.3 CDN -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <!-- Bootstrap Icons -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.css" rel="stylesheet">
    <!-- Google Fonts: Poppins -->
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&display=swap" rel="stylesheet">

    <!-- PWA Manifest -->
    <link rel="manifest" href="data:application/manifest+json;base64,eyJuYW1lIjoiUkMgQ2FyIENvbnRyb2xsZXIiLCJzaG9ydF9uYW1lIjoiUkNDdHJsbCIsInN0YXJ0X3VybCI6Ii8iLCJkaXNwbGF5Ijoic3RhbmRhbG9uZSIsImJhY2tncm91bmRfY29sb3IiOiIjMTcyYTU1IiwidGhlbWVfY29sb3IiOiIjMWUzYThhIiwiaWNvbnMiOlt7InNyYyI6Imh0dHBzOi8zLmJwLmJsb2cuY29tLy1vX0d3V1d3V1d3L0ltYWdlcy8yMDIzMDUvMjAyMzA1MjMxNjQ3NTNfcmFjZV9jYXJfaWNvbl80MDAucG5nIiwic2l6ZXMiOiIxOTJ4MTkyIiwidHlwZSI6ImltYWdlL3BuZyIsInB1cnBvc2UiOiJhbmltYWskIn0seyJzcmMiOiJodHRwczovLzMuYnAuYmxvZy5jb20vLW9fR3dXV3dXV3cvSW1hZ2VzLzIwMjMwNS8yMDIzMDUyMzE2NDc1M19yYWNlX2Nhcl9pY29uXzUxMi5wbmciLCJzaXplcyI6IjUxMng1MTIiLCJ0eXBlIjoiaW1hZ2UvcG5nIiwicHVycG9zZSI6ImFuaW1hc2sgIn1dfQ==">

    <style>
        :root {
            --primary: #1e3a8a;
            --primary-dark: #172a55;
            --success: #10b981;
            --danger: #ef4444;
            --gray-dark: #1f2937;
        }
        body {
            font-family: 'Poppins', sans-serif;
            background: linear-gradient(135deg, #0f172a 0%, #1e293b 100%);
            color: #e2e8f0;
            min-height: 100vh;
            padding-bottom: 80px;
        }
        .navbar-bottom {
            position: fixed;
            bottom: 0;
            left: 0;
            right: 0;
            background: rgba(30, 58, 138, 0.95);
            backdrop-filter: blur(10px);
            border-top: 1px solid rgba(255,255,255,0.1);
            z-index: 1000;
        }
        .nav-link {
            color: #94a3b8 !important;
            font-weight: 500;
        }
        .nav-link.active {
            color: white !important;
            background-color: rgba(255,255,255,0.1);
        }
        .hero-img {
            max-width: 100%;
            height: auto;
            border-radius: 1.5rem;
            box-shadow: 0 20px 40px rgba(0,0,0,0.4);
        }
        .status-circle {
            width: 100px;
            height: 100px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 3rem;
            margin: 0 auto 1rem;
            box-shadow: 0 10px 30px rgba(0,0,0,0.5);
        }
        .connected { background: var(--success); }
        .disconnected { background: var(--danger); }
        .connecting { background: #f59e0b; animation: pulse 1.5s infinite; }
        @keyframes pulse {
            0% { opacity: 0.8; }
            50% { opacity: 1; }
            100% { opacity: 0.8; }
        }
        .control-btn {
            width: 90px;
            height: 90px;
            border-radius: 50%;
            font-size: 2rem;
            font-weight: bold;
            display: flex;
            align-items: center;
            justify-content: center;
            box-shadow: 0 8px 20px rgba(0,0,0,0.4);
            user-select: none;
            touch-action: manipulation;
        }
        .stop-btn {
            width: 110px;
            height: 110px;
            background: var(--danger) !important;
            font-size: 1.5rem;
        }
        .dpad-container {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            grid-template-rows: repeat(3, 1fr);
            gap: 15px;
            max-width: 320px;
            margin: 2rem auto;
        }
        .dpad-up    { grid-column: 2; grid-row: 1; }
        .dpad-left  { grid-column: 1; grid-row: 2; }
        .dpad-center{ grid-column: 2; grid-row: 2; }
        .dpad-right { grid-column: 3; grid-row: 2; }
        .dpad-down  { grid-column: 2; grid-row: 3; }
        .btn-pressed {
            transform: scale(0.92);
            box-shadow: 0 4px 10px rgba(0,0,0,0.6) !important;
        }
        .card-link {
            transition: transform 0.2s, box-shadow 0.2s;
        }
        .card-link:hover {
            transform: translateY(-5px);
            box-shadow: 0 20px 40px rgba(0,0,0,0.3);
        }
    </style>
</head>
<body>

<div class="container py-4">

    <!-- Tab Content -->
    <div class="tab-content" id="nav-tabContent">

        <!-- Home Tab -->
        <div class="tab-pane fade show active" id="home" role="tabpanel">
            <div class="text-center mt-5">
                <h1 class="display-4 fw-bold text-white mb-3">RC Car Controller</h1>
                <p class="lead text-gray-300 mb-5">Control your Arduino RC car via Bluetooth</p>
                <img src="https://images.unsplash.com/photo-1509474405575-9071e62f4d3d?ixlib=rb-4.0.3&auto=format&fit=crop&w=800&q=80" alt="RC Car" class="hero-img mb-5">
                <p class="text-gray-400 mb-4">Fast • Reliable • Touch Optimized</p>
                <button class="btn btn-primary btn-lg px-5" onclick="switchTab('control')">
                    <i class="bi bi-controller me-2"></i> Go to Control
                </button>
                <p class="mt-5 text-gray-500 small">Made with ❤️ by STEM ST159</p>
            </div>
        </div>

        <!-- Control Tab -->
        <div class="tab-pane fade" id="control" role="tabpanel">
            <div class="text-center mt-4">
                <h2 class="h3 fw-bold text-white mb-4">Bluetooth Control</h2>

                <!-- Status Indicator -->
                <div class="status-circle disconnected mb-3" id="statusCircle">
                    <i class="bi bi-bluetooth" id="statusIcon"></i>
                </div>
                <h3 id="statusText" class="text-danger fw-semibold">Disconnected</h3>
                <p id="deviceName" class="text-gray-400 small mt-2"></p>

                <!-- Connect / Disconnect Button -->
                <div class="mt-4">
                    <button id="connectBtn" class="btn btn-primary btn-lg px-5" onclick="connectBluetooth()">
                        <span class="spinner-border spinner-border-sm d-none" id="loadingSpinner"></span>
                        Connect Bluetooth
                    </button>
                    <button id="disconnectBtn" class="btn btn-outline-danger btn-lg px-5 d-none" onclick="disconnectBluetooth()">
                        Disconnect
                    </button>
                </div>

                <!-- Speed Slider -->
                <div class="mt-5 px-4">
                    <label for="speedSlider" class="form-label text-white">Speed: <span id="speedValue">150</span></label>
                    <input type="range" class="form-range" min="0" max="255" value="150" id="speedSlider" oninput="updateSpeed(this.value)">
                </div>

                <!-- D-Pad Controls -->
                <div class="dpad-container mt-5">
                    <button class="btn btn-primary control-btn dpad-up"    ontouchstart="sendCommand('F')" ontouchend="sendCommand('S')" onmousedown="sendCommand('F')" onmouseup="sendCommand('S')"><i class="bi bi-arrow-up"></i></button>
                    <div></div>
                    <button class="btn btn-primary control-btn dpad-left"  ontouchstart="sendCommand('L')" ontouchend="sendCommand('S')" onmousedown="sendCommand('L')" onmouseup="sendCommand('S')"><i class="bi bi-arrow-left"></i></button>
                    <button class="btn btn-danger control-btn stop-btn dpad-center" onclick="sendCommand('S')">STOP</button>
                    <button class="btn btn-primary control-btn dpad-right" ontouchstart="sendCommand('R')" ontouchend="sendCommand('S')" onmousedown="sendCommand('R')" onmouseup="sendCommand('S')"><i class="bi bi-arrow-right"></i></button>
                    <div></div>
                    <button class="btn btn-primary control-btn dpad-down"  ontouchstart="sendCommand('B')" ontouchend="sendCommand('S')" onmousedown="sendCommand('B')" onmouseup="sendCommand('S')"><i class="bi bi-arrow-down"></i></button>
                </div>

                <p class="text-gray-500 small mt-5">Tip: Hold direction buttons to move continuously</p>
            </div>
        </div>

        <!-- Contact Tab -->
        <div class="tab-pane fade" id="contact" role="tabpanel">
            <div class="mt-5 px-3">
                <h2 class="h3 fw-bold text-white text-center mb-5">Contact & Social</h2>

                <div class="row g-4">
                    <div class="col-12">
                        <a href="https://www.facebook.com/share/1JsBTpJPKS/" target="_blank" class="text-decoration-none">
                            <div class="card bg-primary text-white card-link border-0 shadow-lg">
                                <div class="card-body text-center py-4">
                                    <i class="bi bi-facebook fs-1 mb-3"></i>
                                    <h5 class="mb-0">Facebook Page</h5>
                                </div>
                            </div>
                        </a>
                    </div>
                    <div class="col-12">
                        <a href="https://stemst159-hue.github.io/stem.github.io/" target="_blank" class="text-decoration-none">
                            <div class="card bg-success text-white card-link border-0 shadow-lg">
                                <div class="card-body text-center py-4">
                                    <i class="bi bi-globe fs-1 mb-3"></i>
                                    <h5 class="mb-0">Our Website</h5>
                                </div>
                            </div>
                        </a>
                    </div>
                </div>

                <div class="text-center mt-5 text-gray-500">
                    <p class="mb-1">STEM ST159 Project</p>
                    <p class="small">Arduino RC Car Controller © 2025</p>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- Bottom Navigation -->
<nav class="navbar navbar-expand navbar-dark navbar-bottom">
    <div class="container">
        <ul class="navbar-nav nav-fill w-100 nav-pills">
            <li class="nav-item">
                <a class="nav-link active" href="#home" onclick="switchTab('home')">
                    <i class="bi bi-house fs-4"></i><br><small>Home</small>
                </a>
            </li>
            <li class="nav-item">
                <a class="nav-link" href="#control" onclick="switchTab('control')">
                    <i class="bi bi-controller fs-4"></i><br><small>Control</small>
                </a>
            </li>
            <li class="nav-item">
                <a class="nav-link" href="#contact" onclick="switchTab('contact')">
                    <i class="bi bi-envelope fs-4"></i><br><small>Contact</small>
                </a>
            </li>
        </ul>
    </div>
</nav>

<script>
    // Web Bluetooth variables
    let device, server, service, characteristic;
    let currentSpeed = 150;

    // Service & Characteristic UUIDs for HC-05 (HM-10 style)
    const SERVICE_UUID = '0000ffe0-0000-1000-8000-00805f9b34fb';
    const CHAR_UUID    = '0000ffe1-0000-1000-8000-00805f9b34fb';

    // DOM Elements
    const statusCircle = document.getElementById('statusCircle');
    const statusText   = document.getElementById('statusText');
    const deviceName   = document.getElementById('deviceName');
    const connectBtn   = document.getElementById('connectBtn');
    const disconnectBtn= document.getElementById('disconnectBtn');
    const loadingSpinner = document.getElementById('loadingSpinner');
    const speedValue   = document.getElementById('speedValue');

    // Check Web Bluetooth support
    if (!navigator.bluetooth) {
        alert('Web Bluetooth is not supported in your browser. Use Chrome on Android.');
    }

    // Connect to HC-05
    async function connectBluetooth() {
        try {
            setConnectingState(true);
            device = await navigator.bluetooth.requestDevice({
                filters: [{ namePrefix: 'HC' }],
                optionalServices: [SERVICE_UUID]
            });

            server = await device.gatt.connect();
            service = await server.getPrimaryService(SERVICE_UUID);
            characteristic = await service.getCharacteristic(CHAR_UUID);

            deviceName.textContent = device.name || 'HC-05';
            setConnectedState(true);

            // Listen for disconnect
            device.addEventListener('gattserverdisconnected', () => {
                setConnectedState(false);
            });

        } catch (error) {
            console.error(error);
            alert('Connection failed: ' + error.message);
            setConnectedState(false);
        } finally {
            setConnectingState(false);
        }
    }

    function disconnectBluetooth() {
        if (device && device.gatt.connected) {
            device.gatt.disconnect();
        }
        setConnectedState(false);
    }

    function setConnectingState(connecting) {
        loadingSpinner.classList.toggle('d-none', !connecting);
        connectBtn.disabled = connecting;
        statusCircle.className = 'status-circle ' + (connecting ? 'connecting' : 'disconnected');
        statusText.textContent = connecting ? 'Connecting...' : 'Disconnected';
        statusText.className = connecting ? 'text-warning fw-semibold' : 'text-danger fw-semibold';
    }

    function setConnectedState(connected) {
        statusCircle.className = 'status-circle ' + (connected ? 'connected' : 'disconnected');
        statusText.textContent = connected ? 'Connected' : 'Disconnected';
        statusText.className = connected ? 'text-success fw-semibold' : 'text-danger fw-semibold';
        statusCircle.innerHTML = connected ? '<i class="bi bi-check-lg"></i>' : '<i class="bi bi-bluetooth"></i>';

        connectBtn.classList.toggle('d-none', connected);
        disconnectBtn.classList.toggle('d-none', !connected);
    }

    // Send command (F, B, L, R, S) + speed prefix if needed
    async function sendCommand(cmd) {
        if (!characteristic) return;

        let command = cmd;
        if (cmd !== 'S') {
            command = cmd + currentSpeed;  // e.g., F150
        } else {
            command = 'S';
        }

        try {
            await characteristic.writeValueWithoutResponse(new TextEncoder().encode(command));
            if ('vibrate' in navigator) navigator.vibrate(50);
        } catch (err) {
            console.error('Send failed:', err);
        }

        // Visual feedback
        event.target.classList.add('btn-pressed');
        setTimeout(() => event.target.classList.remove('btn-pressed'), 150);
    }

    function updateSpeed(value) {
        currentSpeed = parseInt(value);
        speedValue.textContent = currentSpeed;
    }

    // Tab switching
    function switchTab(tabId) {
        document.querySelectorAll('.tab-pane').forEach(p => p.classList.remove('show', 'active'));
        document.getElementById(tabId).classList.add('show', 'active');

        document.querySelectorAll('.nav-link').forEach(link => link.classList.remove('active'));
        document.querySelector(`a[href="#${tabId}"]`).classList.add('active');
    }

    // PWA Install Prompt (optional)
    window.addEventListener('beforeinstallprompt', (e) => {
        e.preventDefault();
        deferredPrompt = e;
    });
</script>

<!-- Bootstrap JS -->
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
</body>
</html>
